<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sysu.smartjob.mapper.JobRequirementMapper">

    <insert id="insert" parameterType="com.sysu.smartjob.entity.JobRequirement" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO job_requirements(name, category, level, description, requirements, skills, created_at, updated_at, is_active)
        VALUES(#{name}, #{category}, #{level}, #{description}, #{requirements}, #{skills}, #{createdAt}, #{updatedAt}, #{isActive})
    </insert>

    <update id="update" parameterType="com.sysu.smartjob.entity.JobRequirement">
        UPDATE job_requirements
        <set>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="category != null and category != ''">category = #{category},</if>
            <if test="level != null and level != ''">level = #{level},</if>
            <if test="description != null">description = #{description},</if>
            <if test="requirements != null">requirements = #{requirements},</if>
            <if test="skills != null">skills = #{skills},</if>
            <if test="isActive != null">is_active = #{isActive},</if>
            <if test="updatedAt != null">updated_at = #{updatedAt}</if>
        </set>
        WHERE id = #{id}
    </update>

    <select id="findById" resultType="com.sysu.smartjob.entity.JobRequirement">
        SELECT * FROM job_requirements WHERE id = #{id}
    </select>

    <select id="findByCondition" parameterType="com.sysu.smartjob.entity.JobRequirement" resultType="com.sysu.smartjob.entity.JobRequirement">
        SELECT * FROM job_requirements
        <where>
            <if test="category != null and category != ''">AND category = #{category}</if>
            <if test="level != null and level != ''">AND level = #{level}</if>
            <if test="name != null and name != ''">AND name LIKE CONCAT('%', #{name}, '%')</if>
            <if test="isActive != null">AND is_active = #{isActive}</if>
        </where>
        ORDER BY created_at DESC
    </select>

    <select id="findAllCategories" resultType="String">
        SELECT DISTINCT category FROM job_requirements WHERE is_active = 1
    </select>

    <select id="findLevelsByCategory" parameterType="String" resultType="String">
        SELECT DISTINCT level FROM job_requirements WHERE category = #{category} AND is_active = 1
    </select>

    <select id="countByCategory" parameterType="String" resultType="Long">
        SELECT COUNT(*) FROM job_requirements WHERE category = #{category} AND is_active = 1
    </select>

    <delete id="deleteById">
        DELETE FROM job_requirements WHERE id = #{id}
    </delete>

</mapper>