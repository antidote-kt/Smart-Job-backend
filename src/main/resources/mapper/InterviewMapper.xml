<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sysu.smartjob.mapper.InterviewMapper">

    <insert id="insert" parameterType="com.sysu.smartjob.entity.Interview" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO interview(user_id, title, position, company, interview_type, difficulty_level, 
                             status, total_questions, answered_questions, overall_score, ai_feedback, 
                             start_time, end_time, created_at, updated_at)
        VALUES(#{userId}, #{title}, #{position}, #{company}, #{interviewType}, #{difficultyLevel}, 
               #{status}, #{totalQuestions}, #{answeredQuestions}, #{overallScore}, #{aiFeedback}, 
               #{startTime}, #{endTime}, #{createdAt}, #{updatedAt})
    </insert>

    <update id="update" parameterType="com.sysu.smartjob.entity.Interview">
        UPDATE interview
        <set>
            <if test="title != null and title != ''">title = #{title},</if>
            <if test="position != null and position != ''">position = #{position},</if>
            <if test="company != null and company != ''">company = #{company},</if>
            <if test="interviewType != null">interview_type = #{interviewType},</if>
            <if test="difficultyLevel != null">difficulty_level = #{difficultyLevel},</if>
            <if test="status != null">status = #{status},</if>
            <if test="totalQuestions != null">total_questions = #{totalQuestions},</if>
            <if test="answeredQuestions != null">answered_questions = #{answeredQuestions},</if>
            <if test="overallScore != null">overall_score = #{overallScore},</if>
            <if test="aiFeedback != null">ai_feedback = #{aiFeedback},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            updated_at = NOW()
        </set>
        WHERE id = #{id}
    </update>

    <select id="findById" parameterType="com.sysu.smartjob.entity.Interview" resultType="com.sysu.smartjob.entity.Interview">
        SELECT * FROM interview WHERE id = #{id}
    </select>

    <select id="findByCondition" parameterType="com.sysu.smartjob.entity.Interview" resultType="com.sysu.smartjob.entity.Interview">
        SELECT * FROM interview
        <where>
            <if test="userId != null">AND user_id = #{userId}</if>
            <if test="status != null">AND status = #{status}</if>
            <if test="position != null and position != ''">AND position LIKE CONCAT('%', #{position}, '%')</if>
            <if test="company != null and company != ''">AND company LIKE CONCAT('%', #{company}, '%')</if>
            <if test="interviewType != null">AND interview_type = #{interviewType}</if>
            <if test="difficultyLevel != null">AND difficulty_level = #{difficultyLevel}</if>
        </where>
        ORDER BY created_at DESC
    </select>

    <delete id="deleteById" parameterType="com.sysu.smartjob.entity.Interview">
        DELETE FROM interview WHERE id = #{id}
    </delete>

</mapper>